---
sidebar: sidebar 
permalink: get-started/acc_operatorhub_install.html 
keywords: how to install astra control center, operator, operatorhub, openshift, install astra control center operator 
summary: 如果您使用的是 Red Hat OpenShift ，则可以使用操作员安装 Astra 控制中心。 
---
= 使用 OpenShift OperatorHub 安装 Astra 控制中心
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/get-started/


[role="lead"]
如果您使用的是 Red Hat OpenShift ，则可以使用 Red Hat 认证操作员安装 Astra Control Center 。使用此操作步骤从安装 Astra 控制中心 https://catalog.redhat.com/software/operators/explore["Red Hat 生态系统目录"^] 或使用 Red Hat OpenShift 容器平台。

完成此操作步骤后，您必须返回到安装操作步骤以完成 link:../get-started/install_acc.html#verify-system-status["剩余步骤"] 以验证安装是否成功并登录。

.您需要什么？ #8217 ；将需要什么
* link:requirements.html["开始安装之前，请为 Astra Control Center 部署准备您的环境"]。
* 在OpenShift集群中、确保所有集群操作员均处于运行状况良好的状态：
+
[source, console]
----
oc get clusteroperators
----
* 在OpenShift集群中、确保所有API服务均处于运行状况良好的状态：
+
[source, console]
----
oc get apiservices
----
* 在数据中心中为Astra控制中心创建FQDN地址。
* 获取对Red Hat OpenShift容器平台的必要权限和访问权限、以执行所述的安装步骤。
* 如果集群中已存在证书管理器、则需要执行某些操作 link:../get-started/cert-manager-prereqs.html["前提条件步骤"] 这样、Astra控制中心就不会安装自己的证书管理器。默认情况下、Astra控制中心会在安装期间安装自己的证书管理器。


.步骤
*  and unpack the Astra Control Center bundle
*  the NetApp Astra kubectl plugin
*  the images to your local registry
*  the operator install page
*  the operator
*  Astra Control Center




== 下载并解包Astra Control Center软件包

. 从下载 Astra 控制中心捆绑包（`Astra-control-center-[version].tar.gz` ） https://mysupport.netapp.com/site/products/all/details/astra-control-center/downloads-tab["NetApp 支持站点"^]。
. 从下载 Astra 控制中心证书和密钥的 zip https://mysupport.netapp.com/site/products/all/details/astra-control-center/downloads-tab["NetApp 支持站点"^]。
. （可选）验证捆绑包的签名：
+
[source, console]
----
openssl dgst -sha256 -verify AstraControlCenter-public.pub -signature astra-control-center-[version].tar.gz.sig astra-control-center-[version].tar.gz
----
. 提取映像：
+
[source, console]
----
tar -vxzf astra-control-center-[version].tar.gz
----




== 安装NetApp Astra kubectl插件

NetApp Astra kubectl命令行插件可节省执行与部署和升级Astra控制中心相关的常见任务所需的时间。

NetApp可为不同的CPU架构和操作系统提供插件二进制文件。在执行此任务之前、您需要了解您的CPU和操作系统。

.步骤
. 列出可用的NetApp Astra kubectl插件二进制文件、并记下操作系统和CPU架构所需的文件名称：
+

NOTE: kubectl插件库是tar包的一部分、并会解压缩到文件夹中 `kubectl-astra`。

+
[source, console]
----
ls kubectl-astra/
----
. 将正确的二进制文件移动到当前路径并重命名为 `kubectl-astra`：
+
[source, console]
----
cp kubectl-astra/<binary-name> /usr/local/bin/kubectl-astra
----




== 将映像添加到本地注册表

. 为容器引擎完成相应的步骤顺序：


[role="tabbed-block"]
====
.Docker
--
. 更改为 `acc` 从tar包中提取的目录：
+
示例



[listing]
----
cd ../acc
----
. [substep_image_local_registry_push]]将Astra控制中心映像目录中的软件包映像推送到本地注册表。在运行命令之前、请执行以下替换操作：
+
** 将<BUNDLE_FILE> 替换为Astra Control捆绑包文件的名称 (`acc.manifest.yaml`）。
** 将<MY_FULL_REGISTRY_PATH> 替换为Docker存储库的URL；例如 https://exampledownloads.jfrog.io/docker-astra-control/v1/[]。
** 将<MY_REGISTRY_USER> 替换为用户名。
** 将<MY_REGISTRY_TOKEN> 替换为注册表的授权令牌。
+
[source, console]
----
kubectl astra packages push-images -m <BUNDLE_FILE> -r <MY_FULL_REGISTRY_PATH> -u <MY_REGISTRY_USER> -p <MY_REGISTRY_TOKEN>
----




--
.Podman
--
. 登录到注册表：
+
[source, console]
----
podman login <MY_FULL_REGISTRY_PATH>
----
. 运行以下脚本、按照注释中的说明替换<your_registry>：
+
[source, console]
----
# You need to be at the root of the tarball.
# You should see these files to confirm correct location:
#   acc.manifest.yaml
#   acc/

# Replace <YOUR_REGISTRY> with your own registry (e.g registry.customer.com or registry.customer.com/testing, etc..)
export REGISTRY=<YOUR_REGISTRY>
export PACKAGENAME=acc
export PACKAGEVERSION=22.11.0-82
export DIRECTORYNAME=acc
for astraImageFile in $(ls ${DIRECTORYNAME}/images/*.tar) ; do
  # Load to local cache
  astraImage=$(podman load --input ${astraImageFile} | sed 's/Loaded image(s): //')

  # Remove path and keep imageName.
  astraImageNoPath=$(echo ${astraImage} | sed 's:.*/::')

  # Tag with local image repo.
  podman tag ${astraImage} ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}

  # Push to the local repo.
  podman push ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}
done
----


--
====


== 找到操作员安装页面

. 要访问操作员安装页面，请完成以下过程之一：
+
** 从 Red Hat OpenShift Web 控制台：image:openshift_operatorhub.png["Astra 控制中心安装页面"]
+
... 登录到 OpenShift 容器平台 UI 。
... 从侧面菜单中，选择 * 运算符 > OperatorHub * 。
... 选择 NetApp Astra Control Center 操作员。
... 选择 * 安装 * 。


** 从 Red Hat 生态系统目录：image:red_hat_catalog.png["Astra 控制中心概述页面"]
+
... 选择 NetApp Astra 控制中心 https://catalog.redhat.com/software/operators/detail/611fd22aaf489b8bb1d0f274["运算符"]。
... 选择 * 部署并使用 * 。








== 安装操作员

. 完成 * 安装操作员 * 页面并安装操作员：
+

NOTE: 操作员将在所有集群命名空间中可用。

+
.. 选择运算符命名空间或 `netapp-ac-operator` namespace will be created automatically as part of the operator install.
.. 选择手动或自动批准策略。
+

NOTE: 建议手动批准。每个集群只能运行一个操作员实例。

.. 选择 * 安装 * 。
+

NOTE: 如果您选择了手动批准策略，系统将提示您批准此操作员的手动安装计划。



. 从控制台中，转到 OperatorHub 菜单并确认操作员已成功安装。




== 安装 Astra 控制中心

. 在 Astra 控制中心操作员的详细信息视图的控制台中，在提供的 API 部分中选择 `Create instance` 。
. 填写 `Create AstraControlCenter` Form 字段：
+
.. 保留或调整 Astra 控制中心名称。
.. （可选）启用或禁用自动支持。建议保留自动支持功能。
.. 输入 Astra 控制中心地址。请勿在此地址中输入 `http ： //` 或 `https ： //` 。
.. 输入 Astra 控制中心版本；例如 21.12.60 。
.. 输入帐户名称，电子邮件地址和管理员姓氏。
.. 保留默认卷回收策略。
.. 在 * 映像注册表 * 中，输入本地容器映像注册表路径。请勿在此地址中输入 `http ： //` 或 `https ： //` 。
.. 如果您使用的注册表需要身份验证，请输入密钥。
.. 输入管理员的名字。
.. 配置资源扩展。
.. 保留默认存储类。
.. 定义 CRD 处理首选项。


. 选择 `Create` 。




== 下一步行动

验证是否已成功安装 Astra 控制中心并完成 link:../get-started/install_acc.html#verify-system-status["剩余步骤"] 登录。此外，您还可以通过执行来完成部署 link:setup_overview.html["设置任务"]。
